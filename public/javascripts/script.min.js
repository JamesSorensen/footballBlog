$((function(){function o(){$("form.login p.error, form.register p.error").remove(),$("form.login input, form.register input").removeClass("error")}var t=!0;$(".switch-button").on("click",(function(r){r.preventDefault(),$("input").val(""),o(),t?(t=!1,$(".register").show("slow"),$(".login").hide()):(t=!0,$(".login").show("slow"),$(".register").hide())})),$("form.login input, form.register input").on("focus",(function(){o()})),$(".register-button").on("click",(function(t){t.preventDefault(),o();var r={login:$("#register-login").val(),password:$("#register-password").val(),passwordConfirm:$("#register-password-confirm").val()};$.ajax({type:"POST",data:JSON.stringify(r),contentType:"application/json",url:"/api/auth/register"}).done((function(o){console.log(o.ok),o.ok?$(location).attr("href","/"):($(".register h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach((function(o){$("input[name="+o+"]").addClass("error")})))}))})),$(".login-button").on("click",(function(t){t.preventDefault(),o();var r={login:$("#login-login").val(),password:$("#login-password").val()};$.ajax({type:"POST",data:JSON.stringify(r),contentType:"application/json",url:"/api/auth/login"}).done((function(o){o.ok?$(location).attr("href","/"):($(".login h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach((function(o){$("input[name="+o+"]").addClass("error")})))}))}))})),$((function(){function o(){$(".post-form p.error").remove(),$(".post-form input, #post-body").removeClass("error")}$(".post-form input, #post-body").on("focus",(function(){o()})),$(".publish-button, .save-button").on("click",(function(t){t.preventDefault(),o();var r="save-button"===$(this).attr("class").split(" ")[0],e={title:$("#post-title").val(),body:$("#post-body").val(),isDraft:r,postId:$("#post-id").val()};$.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:"/post/add"}).done((function(o){console.log(o),o.ok?r?$(location).attr("href","/post/edit/"+o.post.id):$(location).attr("href","/posts/"+o.post.url):($(".post-form h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach((function(o){$("#post-"+o).addClass("error")})))}))})),$("#fileinfo").on("submit",(function(o){o.preventDefault();var t=new FormData(this);$.ajax({type:"POST",url:"/upload/image",data:t,processData:!1,contentType:!1,success:function(o){console.log(o)},error:function(o){console.log(o)}})}))})),$((function(){var o,t;function r(r,e){if($(".reply").show(),o&&o.remove(),t=null,o=$(".comment").clone(!0,!0),r)o.find(".cancel").hide(),o.appendTo(".comment-list");else{var n=$(e).parent();t=n.attr("id"),$(e).after(o)}o.css("display","flex")}r(!0),$(".reply").on("click",(function(o){r(!1,this),$(this).hide()})),$(".cancel").on("click",(function(t){t.preventDefault(),o.remove(),r(!0)})),$("form.comment .send").on("click",(function(e){e.preventDefault();var n={post:$(".comments").attr("id"),body:o.find("textarea").val(),parent:t};$.ajax({type:"POST",data:JSON.stringify(n),contentType:"application/json",url:"/comment/add"}).done((function(t){if(console.log(t),t.ok){var e='<ul><li style="background-color:#ffffe0;"><div class="head"><a href="/users/'+t.login+'">'+t.login+'</a><spam class="date">Только что</spam></div>'+t.body+"</li></ul>";$(o).after(e),r(!0)}else void 0===t.error&&(t.error="Неизвесная ошибка"),$(o).prepend('<p class="error">'+t.error+"</p>")}))}))}));